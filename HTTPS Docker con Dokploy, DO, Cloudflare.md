# **Asegurando su Proyecto Docker con HTTPS en Dokploy: Una Guía Completa para la Integración con DigitalOcean y Cloudflare**

## **Introducción a HTTPS y las Capacidades SSL de Dokploy**

HTTPS (Hypertext Transfer Protocol Secure) es una piedra angular para las aplicaciones web modernas, trascendiendo la mera seguridad para convertirse en un factor crítico para la confianza del usuario, el cumplimiento normativo y la optimización para motores de búsqueda (SEO). Su función principal es cifrar la comunicación entre el navegador de un usuario y el servidor, salvaguardando la integridad y la confidencialidad de los datos.  
Dokploy simplifica significativamente la implementación de HTTPS al integrar **Traefik** como su robusto proxy inverso y aprovechar **Let's Encrypt** para la gestión automatizada de certificados SSL/TLS. Esta integración significa que, para la mayoría de los usuarios, las complejidades de la generación, renovación e instalación de certificados se gestionan de forma transparente por la plataforma Dokploy. Es importante destacar que, si bien Dokploy ofrece dominios gratuitos a través de traefik.me, estos están inherentemente limitados a conexiones HTTP. Para lograr HTTPS, la posesión y gestión de un dominio personalizado es un requisito previo. Las capacidades de gestión de dominios de Dokploy se extienden tanto a "Aplicaciones" individuales como a implementaciones más complejas de "Docker Compose", lo que garantiza flexibilidad para diversas estructuras de proyectos.  
Dokploy, al ser una plataforma gestionada, simplifica la configuración de HTTPS al integrar Traefik como su proxy inverso y Let's Encrypt para la gestión de certificados. Esta integración automatiza la generación y renovación de certificados, liberando al usuario de gran parte de la complejidad técnica. Sin embargo, esta capa de abstracción, si bien beneficiosa para la facilidad de uso, puede presentar desafíos cuando surgen problemas, especialmente aquellos que involucran servicios externos como Cloudflare. En tales escenarios, una comprensión más profunda de cómo Traefik maneja el enrutamiento (por ejemplo, a través de etiquetas en Docker Compose ) y cómo Let's Encrypt realiza la validación de dominios (desafíos ACME ) se vuelve indispensable para una resolución efectiva de problemas. Esto ilustra una tensión inherente en las plataformas gestionadas: la simplicidad para casos estándar frente a la necesidad de conocimiento técnico subyacente en situaciones complejas o problemáticas.

## **Prerrequisitos para la Configuración HTTPS**

Antes de proceder con la configuración de HTTPS en su proyecto Docker con Dokploy, DigitalOcean y Cloudflare, es fundamental asegurarse de que se cumplen los siguientes prerrequisitos:

* **Registro de Nombre de Dominio:** Es indispensable poseer un nombre de dominio personalizado (por ejemplo, suproyecto.com) registrado a través de un proveedor de dominios.  
* **Droplet de DigitalOcean con Dokploy Instalado:** Su instancia de Dokploy debe estar operativa y alojada en un Droplet de DigitalOcean, que actuará como su servidor de origen.  
* **Configuración de Cuenta Cloudflare:** Su dominio personalizado debe estar activamente gestionado por Cloudflare, con sus servidores de nombres apuntando a Cloudflare. Esta configuración es esencial para habilitar las funcionalidades de DNS, CDN y seguridad de Cloudflare.  
* **Proyecto Docker Compose Listo:** Los servicios de su aplicación deben estar definidos dentro de un archivo docker-compose.yml, preparado para su despliegue a través de Dokploy.

La arquitectura de implementación propuesta, que abarca DigitalOcean como proveedor de servidor, Cloudflare para la gestión de DNS y CDN, y Dokploy para la orquestación de aplicaciones Docker Compose, implica una interdependencia crítica entre cada componente. Para lograr una configuración HTTPS exitosa, se requiere una sincronización precisa en toda la cadena de comunicación: desde la resolución DNS (DigitalOcean/Cloudflare) hasta el proxy inverso (Dokploy/Traefik) y, finalmente, el contenedor de la aplicación. Una configuración incorrecta en cualquier punto de esta cadena (por ejemplo, un registro DNS erróneo, un modo SSL de Cloudflare en conflicto o una aplicación que no escucha en la interfaz de red correcta) puede comprometer la conexión segura completa. Esto subraya la necesidad de una estrategia de configuración integral, donde cada paso se comprende en el contexto del sistema general para asegurar la continuidad del servicio y la seguridad.

## **Guía de Configuración Paso a Paso**

La configuración de HTTPS para su proyecto Dokploy en Docker, utilizando DigitalOcean y Cloudflare, implica una serie de pasos secuenciales y coordinados a través de las interfaces de cada plataforma.

### **1\. Configuración de DNS en DigitalOcean**

El primer paso crucial es asegurar que su dominio apunte correctamente a su servidor de DigitalOcean.

* **Apuntar Servidores de Nombres a DigitalOcean (Paso Inicial, si aplica):** Si su dominio no está utilizando DigitalOcean para la gestión de DNS, el primer paso sería actualizar los servidores de nombres de su registrador de dominios para que apunten a los servidores de nombres de DigitalOcean. Este paso es típico si DigitalOcean es su proveedor de DNS principal.  
* **Creación de Registros A para su Dominio en DigitalOcean:** Dentro de su cuenta de DigitalOcean, navegue a la pestaña **Networking**. Aquí, añadirá su dominio a la gestión de DNS de DigitalOcean. Debe crear un registro A que mapee su dominio (por ejemplo, sudominio.com o www.sudominio.com) a la dirección IPv4 pública de su Droplet de Dokploy. Este registro es fundamental ya que dirige el tráfico de Internet de su dominio hacia su servidor. Si planea utilizar subdominios (por ejemplo, api.sudominio.com), deberá crear registros A separados para cada uno, también apuntando a la misma IP del Droplet.

Es fundamental comprender que los cambios en los registros DNS, especialmente los nuevos registros A, están sujetos a demoras de propagación a través de Internet. El proceso de generación de certificados Let's Encrypt, que Dokploy utiliza automáticamente, depende de que el dominio apunte correctamente a la IP del servidor antes de añadirlo en Dokploy. Si el registro A no se ha propagado globalmente cuando Dokploy intenta obtener el certificado, el desafío ACME fallará, impidiendo la emisión del certificado. Por lo tanto, la paciencia y la verificación de la propagación del DNS (por ejemplo, utilizando herramientas de consulta DNS en línea) son cruciales antes de proceder con la configuración del dominio en Dokploy.

### **2\. Configuración de DNS y SSL/TLS en Cloudflare**

Una vez que el DNS básico está configurado en DigitalOcean, Cloudflare toma el control para proporcionar sus servicios de seguridad y rendimiento.

* **Adición de Registros DNS en Cloudflare:** Después de que los servidores de nombres de su dominio apunten a Cloudflare, gestionará sus registros DNS directamente desde el panel de control de Cloudflare. Cree registros A para su dominio principal y cualquier subdominio, asegurándose de que apunten a la dirección IPv4 de su Droplet de DigitalOcean. **Es crucial asegurarse de que el estado del proxy (representado por un icono de nube naranja) esté habilitado para estos registros A**. Esto dirige el tráfico a través de la red global de Cloudflare, activando su CDN, Web Application Firewall (WAF) y servicios SSL/TLS. Si el proxy está deshabilitado (nube gris), Cloudflare actuará solo como proveedor de DNS, omitiendo sus características de seguridad y rendimiento.  
* **Elección del Modo de Cifrado SSL/TLS Óptimo:** Cloudflare ofrece varios modos de cifrado SSL/TLS, cada uno definiendo cómo se maneja el cifrado entre el visitante, Cloudflare y su servidor de origen (Dokploy). Estos modos son: Flexible, Completo (Full), Completo (Estricto), Estricto (Solo Extracción de Origen SSL) y Apagado.  
  * **Recomendación: Completo (Estricto).** Este modo proporciona el nivel más alto de seguridad al imponer el cifrado de extremo a extremo. Cifra el tráfico entre el visitante y Cloudflare y, fundamentalmente, también entre Cloudflare y su servidor de origen. Además, valida el certificado de origen (su certificado Let's Encrypt emitido por Dokploy), garantizando una conexión de confianza en toda la ruta.  
  * **Modo Flexible:** Cifra solo entre el visitante y Cloudflare. El tráfico de Cloudflare a su servidor de origen se envía sin cifrar a través de HTTP. Este modo puede provocar bucles de redirección si su servidor de origen redirige automáticamente las solicitudes HTTP a HTTPS.  
  * **Modo Completo (Full):** Habilita el cifrado de extremo a extremo, pero *no* valida el certificado de origen. Aunque cifrado, es menos seguro que Completo (Estricto) ya que no verifica la autenticidad del certificado de su servidor de origen.  
  * Para configurar el modo SSL/TLS: Navegue a su Panel de Cloudflare \-\> Seleccione su Dominio \-\> Haga clic en SSL/TLS en la barra lateral izquierda \-\> Overview \-\> Configure SSL/TLS Encryption. Seleccione el modo deseado y haga clic en Save.

La siguiente tabla compara los modos SSL/TLS de Cloudflare para facilitar la comprensión de sus implicaciones de seguridad y su interacción con su servidor de origen:

| Modo SSL/TLS de Cloudflare | Cifrado Visitante-Cloudflare | Cifrado Cloudflare-Origen | Validación de Certificado de Origen | Caso de Uso Recomendado | Problemas Potenciales |
| :---- | :---- | :---- | :---- | :---- | :---- |
| **Flexible** | Sí (HTTPS) | No (HTTP) | N/A | Sitios sin SSL en origen | Bucles de redirección si el origen redirige a HTTPS |
| **Completo (Full)** | Sí (HTTPS) | Sí (HTTPS) | No | Origen con SSL, pero certificado no público/válido | Menos seguro que Full (Strict) |
| **Completo (Estricto)** | Sí (HTTPS) | Sí (HTTPS) | Sí | **Recomendado:** Máxima seguridad, origen con certificado válido | Requiere certificado válido en origen; puede causar bucles si el origen redirige HTTPS a HTTP |
| **Estricto (Solo Extracción de Origen SSL)** | Sí (HTTPS) | Sí (HTTPS) | Sí | Similar a Full (Strict), enfoque en pull del origen | Similar a Full (Strict) |
| **Apagado (No Seguro)** | No | No | N/A | No recomendado para producción | Sin cifrado, advertencias de navegador |

* **(Opcional) Configuración de HTTP Strict Transport Security (HSTS) en Cloudflare:** HSTS es un mecanismo de política de seguridad que instruye a los navegadores web para que interactúen con su sitio web solo a través de HTTPS, previniendo ataques de degradación y mejorando la seguridad general. Logra esto añadiendo un encabezado HTTP que transforma los enlaces HTTP a HTTPS y evita que los usuarios omitan las advertencias del navegador SSL.Para habilitar HSTS en Cloudflare: Navegue a su Panel de Cloudflare \-\> Seleccione su Dominio \-\> SSL/TLS \-\> Edge Certificates. Bajo "HTTP Strict Transport Security (HSTS)", seleccione Enable HSTS. Puede configurar el Max Age Header (duración de la política HSTS), Apply HSTS policy to subdomains (incluir subdominios) y Preload (enviar su dominio a las listas de precarga HSTS del navegador para una aplicación inmediata).**Advertencia:** HSTS es una característica de seguridad potente pero requiere una implementación cuidadosa. Si HTTPS se deshabilita alguna vez o su certificado de origen deja de ser válido durante un período prolongado (antes de que expire el Max Age), su sitio web podría volverse inaccesible para los visitantes. Asegúrese de que su configuración HTTPS sea estable y confiable antes de habilitar HSTS.La capa de proxy de Cloudflare, aunque beneficiosa para el rendimiento y la seguridad, introduce una complejidad que puede interferir con el proceso de validación de dominio de Let's Encrypt si no se configura correctamente. Let's Encrypt realiza su desafío HTTP-01 intentando acceder a una ruta específica (http://sudominio.com/.well-known/acme-challenge/). Las características de seguridad de Cloudflare, como "Always Use HTTPS", las reglas de WAF o el geo-bloqueo, pueden bloquear inadvertidamente estas solicitudes HTTP, impidiendo la emisión del certificado. La clave para superar esto es la necesidad de crear reglas de bypass específicas (Reglas de Página de Cloudflare o Reglas Personalizadas de WAF) para esta ruta, permitiendo que Let's Encrypt valide el dominio. Por ejemplo, una Regla de Página podría configurarse para \*sudominio.com/.well-known/acme-challenge/\* con SSL: Off, Security Level: Off, Cache Level: Bypass y Always Use HTTPS: Off. Alternativamente, se puede crear una Regla Personalizada de WAF para omitir la acción para solicitudes donde la URI Path comience con /.well-known/acme-challenge/ , teniendo en cuenta que las Reglas de Firewall de Cloudflare están siendo reemplazadas por las Reglas Personalizadas de WAF.Aunque Dokploy soporta Let's Encrypt de forma nativa, Cloudflare ofrece sus propios certificados Origin CA gratuitos. Estos certificados son confiables para Cloudflare pero no para los navegadores públicos. Si todo el tráfico de la aplicación se proxy siempre a través de Cloudflare, el uso de un certificado Cloudflare Origin CA en el servidor Dokploy podría simplificar la gestión de SSL en el origen al eliminar la necesidad de confianza pública y los desafíos ACME en el origen. Sin embargo, Dokploy actualmente no soporta la carga/selección directa de certificados Cloudflare Origin CA en su interfaz de usuario. Esto implicaría configuraciones manuales de Traefik, lo que añade complejidad. Esta opción representa una decisión estratégica para el usuario: aprovechar el soporte nativo de Let's Encrypt de Dokploy (con las reglas de bypass de Cloudflare necesarias para la validación) o emprender una configuración manual más compleja para los certificados Cloudflare Origin CA si se busca una gestión de certificados de origen potencialmente más sencilla y si el 100% del tráfico pasa por Cloudflare.Los diversos modos SSL/TLS en Cloudflare, cuando se combinan con posibles redirecciones configuradas en el servidor de origen (Dokploy/Traefik), son una causa principal de los errores ERR\_TOO\_MANY\_REDIRECTS. La implicación crítica es que se debe asegurar la **consistencia** en la redirección HTTP/HTTPS tanto en Cloudflare como en la instancia de Dokploy. Por ejemplo, si Cloudflare está configurado en Flexible (enviando HTTP al origen) y el origen redirige automáticamente HTTP a HTTPS, se producirá un bucle infinito. A la inversa, si Cloudflare está en Full o Full (Strict) (enviando HTTPS al origen) y el origen redirige automáticamente HTTPS a HTTP, también se producirá un bucle. Una alineación cuidadosa de estas configuraciones es primordial para evitar interrupciones en el servicio.

### **3\. Ajustes del Archivo Docker Compose para Dokploy**

La configuración de su archivo docker-compose.yml es vital para que Dokploy y Traefik gestionen correctamente el enrutamiento del tráfico.

* **Integración de la dokploy-network:** Para que Dokploy gestione eficazmente sus servicios Docker Compose y enrute el tráfico entrante a través de su proxy inverso Traefik integrado, es esencial que sus servicios formen parte de la dokploy-network. Añada la directiva networks: \- dokploy-network a cada definición de servicio dentro de su docker-compose.yml que requiera acceso externo o comunicación entre servicios gestionada por Dokploy. En el nivel raíz de su docker-compose.yml, defina la dokploy-network como una red external: true. Esto indica a Docker Compose que la red ya existe y no debe ser creada.  
  `version: "3.8"`  
  `services:`  
    `your_app_service:`  
      `#... (otras configuraciones)`  
      `networks:`  
        `- dokploy-network`

  `networks:`  
    `dokploy-network:`  
      `external: true`

* **Uso de expose para Puertos Internos del Contenedor:** Una configuración crítica es la recomendación de utilizar la directiva expose (por ejemplo, expose: \- 3000\) en lugar de la directiva ports (por ejemplo, ports: \- "3000:3000") al definir los puertos para los servicios de su aplicación en docker-compose.yml. La directiva ports expone directamente un puerto del contenedor al puerto de la máquina host, haciéndolo públicamente accesible si el firewall del host lo permite. Por el contrario, expose hace que el puerto esté disponible *solo* dentro de la red Docker, permitiendo que el proxy inverso Traefik de Dokploy enrute el tráfico internamente a ese puerto sin exponerlo directamente a Internet. Esto previene posibles conflictos de puertos y mejora la seguridad al limitar el acceso directo a sus contenedores de aplicación. El "Container Port" que especifique en la configuración de dominio de la interfaz de usuario de Dokploy (descrito en la siguiente sección) debe corresponder a este puerto interno definido por expose.  
  `services:`  
    `your_app_service:`  
      `image: your_image:latest`  
      `expose:`  
        `- 3000 # Su aplicación escucha en el puerto 3000 dentro del contenedor`  
      `networks:`  
        `- dokploy-network`  
  La recomendación de utilizar expose en lugar de ports en el archivo docker-compose.yml no es simplemente una preferencia de configuración; es una práctica de seguridad fundamental. Al emplear expose, se evita la exposición directa y accidental de los puertos de la aplicación a Internet. En su lugar, todo el tráfico externo se canaliza a través del proxy inverso Traefik integrado de Dokploy, que luego aplica HTTPS y otras políticas de seguridad. Esto reduce significativamente la superficie de ataque de la aplicación, ya que solo Traefik necesita estar expuesto públicamente, actuando como un punto de entrada único y controlado. Los contenedores de la aplicación permanecen aislados, adhiriéndose al principio de menor privilegio.  
* **(Avanzado/Legado) Configuración de Etiquetas Traefik dentro de Docker Compose:** Aunque las versiones de Dokploy v0.7.0 y posteriores soportan la configuración de dominios directamente a través de su interfaz de usuario, simplificando el proceso, sigue siendo técnicamente posible (y a veces necesario para escenarios de enrutamiento muy avanzados o personalizados) configurar etiquetas Traefik directamente dentro de su archivo docker-compose.yml. Las etiquetas clave para el enrutamiento de Traefik incluyen traefik.enable=true para activar el enrutamiento, traefik.http.routers.\<UNIQUE-RULE\>.rule=Host('your-domain.com') para definir la regla de host, y traefik.http.services.\<UNIQUE-RULE\>.loadbalancer.server.port=\<container-port\> para especificar el puerto interno del servicio. Es importante tener en cuenta que si está utilizando la interfaz de usuario de Dokploy para la asignación de dominios, estas etiquetas manuales de Traefik generalmente *no* son necesarias y pueden introducir conflictos o un comportamiento inesperado si se configuran incorrectamente.El soporte nativo de dominios en Dokploy (a partir de la versión v0.7.0) simplifica considerablemente el proceso al abstraer la necesidad de configurar manualmente las etiquetas de Traefik dentro del archivo docker-compose.yml. Esto significa que, para la mayoría de las configuraciones de dominio estándar, se debe priorizar la configuración de dominios directamente a través de la interfaz de usuario de Dokploy, lo que reduce la complejidad y el potencial de errores. Las etiquetas manuales de Traefik deben reservarse para requisitos de enrutamiento avanzados y específicos.

### **4\. Asignación de Dominio en el Panel de Dokploy**

El último paso es configurar el dominio directamente en la interfaz de usuario de Dokploy para habilitar HTTPS.

* **Navegación a la Sección de Dominios:** Inicie sesión en su panel de control de Dokploy. Seleccione el proyecto específico (aplicación o Docker Compose) para el que desea configurar HTTPS. Navegue a la sección "Domains" dentro de la configuración de su proyecto.  
* **Creación de una Nueva Entrada de Dominio:** Haga clic en el botón "Create Domain".  
  * **Host:** Introduzca el nombre de dominio completo (por ejemplo, www.sudominio.com o api.sudominio.com) que ha configurado en el DNS de Cloudflare.  
  * **Path:** Especifique la ruta URL donde su aplicación debe ser accesible. Para la mayoría de las configuraciones de una sola aplicación, esto será / (la ruta raíz).  
  * **Container Port:** Introduzca el número de puerto interno en el que su servicio de aplicación está escuchando *dentro de su contenedor*. Este es el puerto que especificó utilizando la directiva expose en su archivo docker-compose.yml. Es importante aclarar que este "Container Port" es exclusivamente para el enrutamiento interno por parte de Traefik al contenedor de aplicación correcto y no expone directamente el puerto a Internet.  
  * **HTTPS:** Active esta opción a ON para habilitar conexiones seguras para su dominio.  
  * **Certificate:** Seleccione Let's Encrypt del menú desplegable. Esto instruye a Dokploy para solicitar y gestionar automáticamente un certificado SSL/TLS gratuito de Let's Encrypt para su dominio.  
  * Haga clic en Create para guardar la configuración de su dominio.  
* **Verificación:** Después de crear el dominio, Dokploy iniciará el proceso de obtención e instalación del certificado Let's Encrypt. Esto suele tardar desde unos pocos segundos hasta unos pocos minutos. Espere un breve período y luego actualice su aplicación en su navegador web para confirmar que ahora es accesible de forma segura a través de HTTPS (por ejemplo, https://sudominio.com).

Al seleccionar "Let's Encrypt" en la interfaz de usuario de Dokploy, la plataforma automatiza todo el ciclo de vida del certificado, incluyendo el desafío ACME, la emisión del certificado y las renovaciones subsiguientes. Esto reduce significativamente la carga operativa manual asociada con la gestión de certificados SSL, ya que el usuario no necesita intervenir para las renovaciones periódicas (que ocurren cada 90 días para los certificados Let's Encrypt). Esta automatización es un beneficio operativo clave y un aspecto importante de la propuesta de valor de Dokploy más allá de la configuración inicial.

## **Solución de Problemas Comunes de HTTPS**

A pesar de una configuración cuidadosa, pueden surgir problemas de HTTPS. La identificación y resolución de estos problemas requiere un enfoque metódico.

* **Fallos en la Generación de Certificados Let's Encrypt:**  
  * **Retrasos en la Propagación de DNS:** Si el registro A de su dominio no se ha propagado globalmente para apuntar a la IP de su servidor Dokploy *antes* de añadir el dominio en Dokploy, la generación del certificado Let's Encrypt fallará.  
    * **Solución:** Verifique la propagación del DNS utilizando herramientas como dig o verificadores de DNS en línea. Si el dominio se añadió prematuramente en Dokploy, es posible que deba eliminar y volver a añadir la entrada de dominio en la interfaz de usuario de Dokploy, o reiniciar Traefik (a través de las herramientas internas de Dokploy o SSH del servidor si es necesario) después de que el DNS se haya propagado.  
  * **Reglas de WAF/Página de Cloudflare Bloqueando el Desafío ACME:** Let's Encrypt realiza la validación de dominio (desafío HTTP-01) intentando acceder a un archivo específico en http://sudominio.com/.well-known/acme-challenge/. Las características de seguridad de Cloudflare (por ejemplo, "Always Use HTTPS", reglas de WAF, geo-bloqueo o niveles de seguridad agresivos) pueden bloquear estas solicitudes HTTP críticas, impidiendo la emisión del certificado.  
    * **Solución (Regla de Página de Cloudflare):** Cree una Regla de Página de Cloudflare específicamente para omitir la seguridad para la ruta del desafío ACME. El patrón de URL sería \*sudominio.com/.well-known/acme-challenge/\* con las siguientes configuraciones: SSL: Off, Security Level: Off, Cache Level: Bypass, Always Use HTTPS: Off. Asegúrese de que esta regla tenga una prioridad más alta (aparezca más arriba en la lista) que otras reglas en conflicto.  
    * **Solución (Regla Personalizada de WAF de Cloudflare):** Si las Reglas de Página son insuficientes o si prefiere las nuevas Reglas Personalizadas de WAF (nota: las Reglas de Firewall de Cloudflare están en desuso en favor de las Reglas Personalizadas de WAF ), cree una regla para Skip la acción para solicitudes donde la URI Path comience con /.well-known/acme-challenge/.  
* **Bucles de Redirección HTTPS (ERR\_TOO\_MANY\_REDIRECTS):** Este error común ocurre cuando su navegador se atasca en un ciclo de redirección infinito entre HTTP y HTTPS.  
  * **Modo Flexible SSL de Cloudflare \+ Redirección HTTPS de Origen:** Si el modo SSL/TLS de Cloudflare está configurado en Flexible (lo que significa que Cloudflare se conecta a su origen a través de HTTP) y su aplicación Dokploy o la configuración de Traefik redirige automáticamente todas las solicitudes HTTP a HTTPS, se producirá un bucle. Cloudflare envía HTTP, el origen redirige a HTTPS, Cloudflare recibe HTTPS y vuelve a enviar HTTP, repitiendo el ciclo.  
    * **Solución:** Elimine la redirección HTTPS de su servidor de origen (Dokploy/aplicación) o, preferiblemente, actualice su modo de cifrado SSL/TLS de Cloudflare a Full o Full (Strict).  
  * **Modo Full/Strict SSL de Cloudflare \+ Redirección HTTP de Origen:** Si el modo SSL/TLS de Cloudflare es Full o Full (Strict) (lo que significa que Cloudflare se conecta a su origen a través de HTTPS) y su servidor de origen (Dokploy/aplicación) redirige automáticamente todas las solicitudes HTTPS *de vuelta* a HTTP, se producirá un bucle.  
    * **Solución:** Elimine cualquier redirección HTTP de su servidor de origen.  
  * **Conflictos de "Always Use HTTPS" / HSTS de Cloudflare:** Si la función "Always Use HTTPS" de Cloudflare o HSTS (HTTP Strict Transport Security) está habilitada, y su servidor de origen también realiza redirecciones conflictivas, esto puede provocar bucles.  
    * **Solución:** Asegúrese de que las redirecciones de su origen no entren en conflicto con la configuración de Cloudflare, o considere deshabilitar "Always Use HTTPS" en Cloudflare si su servidor de origen gestiona robustamente las redirecciones HTTPS.  
* **Desajustes de Puertos y Configuración de Dirección de Escucha:**  
  * **Puerto de Contenedor Incorrecto:** Asegúrese de que el "Container Port" especificado en la configuración de dominio de la interfaz de usuario de Dokploy coincida precisamente con el puerto en el que su aplicación *realmente* escucha internamente dentro de su contenedor Docker (como se define en la directiva expose de su docker-compose.yml).  
  * **Aplicación Escuchando en 127.0.0.1 (localhost):** Su aplicación que se ejecuta dentro del contenedor Docker debe estar configurada para escuchar en 0.0.0.0 (todas las interfaces de red), no en 127.0.0.1 (localhost). Si solo escucha en 127.0.0.1, el proxy inverso Traefik de Dokploy no podrá acceder a ella desde fuera de la interfaz localhost del contenedor. Por ejemplo, para aplicaciones Vite.js, asegúrese de establecer host: true en su vite.config.js (tanto en los objetos preview como server) para que escuche en 0.0.0.0.  
* **Diagnóstico con Registros de Dokploy y Traefik:**  
  * **Registros de la interfaz de usuario de Dokploy:** Siempre comience revisando los registros de despliegue dentro de la interfaz de usuario de Dokploy para detectar cualquier error durante la construcción o el despliegue de la aplicación.  
  * **Registros de Traefik:** Para obtener información más detallada sobre problemas de enrutamiento y certificados, acceda a su servidor Dokploy por SSH e inspeccione los registros del contenedor Traefik: docker service logs dokploy-traefik. Esto mostrará los intentos de Traefik de enrutar el tráfico y obtener certificados.  
  * **Estado del Contenedor:** Verifique que todos los contenedores principales de Dokploy estén funcionando correctamente: dokploy/dokploy (UI), postgres, redis y traefik. Use docker ps para listar los contenedores en ejecución.  
  * **Recursos del Servidor:** Verifique posibles problemas de recursos del servidor, como espacio en disco insuficiente, que pueden impedir la carga de registros o causar inestabilidad general.

La siguiente tabla resume los escenarios comunes de solución de problemas y sus soluciones:

| Problema/Síntoma | Comportamiento Observado | Causa Potencial | Solución |
| :---- | :---- | :---- | :---- |
| **Certificado Let's Encrypt no emitido** | Navegador muestra "No seguro"; registros de Dokploy/Traefik muestran fallos de desafío ACME. | Retrasos en la propagación de DNS | Verificar propagación DNS. Si se añadió el dominio prematuramente, eliminar y volver a añadir en Dokploy UI o reiniciar Traefik. |
|  |  | Reglas de Cloudflare (WAF/Page Rules) bloqueando el desafío ACME | Crear una Regla de Página de Cloudflare para \*sudominio.com/.well-known/acme-challenge/\* con SSL: Off, Security Level: Off, Cache Level: Bypass, Always Use HTTPS: Off. O una Regla Personalizada de WAF para Skip la acción para URI Path starts with /.well-known/acme-challenge/. |
| **Bucles de Redirección HTTPS (ERR\_TOO\_MANY\_REDIRECTS)** | El navegador se atasca en un bucle HTTP/HTTPS. | Modo Flexible SSL de Cloudflare \+ Redirección HTTPS en origen | Eliminar redirecciones HTTPS del origen o cambiar el modo SSL/TLS de Cloudflare a Full o Full (Strict). |
|  |  | Modo Full/Strict SSL de Cloudflare \+ Redirección HTTP en origen | Eliminar redirecciones HTTP del origen. |
|  |  | Conflictos con "Always Use HTTPS" o HSTS de Cloudflare | Asegurar que las redirecciones del origen no entren en conflicto con la configuración de Cloudflare. |
| **Aplicación inaccesible o error 502 Bad Gateway** | La aplicación no carga o muestra un error de proxy inverso. | Desajuste del "Container Port" en Dokploy UI con el puerto interno de la aplicación | Asegurar que el "Container Port" en Dokploy UI coincida exactamente con el puerto que la aplicación escucha internamente (definido por expose en docker-compose.yml). |
|  |  | Aplicación escuchando en 127.0.0.1 (localhost) en lugar de 0.0.0.0 | Configurar la aplicación para que escuche en 0.0.0.0 (por ejemplo, host: true para Vite.js). |
|  |  | Contenedores Dokploy/Traefik no funcionando correctamente | Verificar el estado de los contenedores (docker ps) y revisar los logs de Traefik (docker service logs dokploy-traefik). |
|  |  | Espacio en disco insuficiente en el servidor | Liberar espacio en disco en el servidor. |

La resolución efectiva de problemas de HTTPS en este entorno requiere un enfoque sistemático y por capas. Se debe depurar desde la capa más externa hacia adentro: primero, la resolución DNS; luego, el procesamiento en el borde de Cloudflare (registros DNS, modo SSL/TLS, reglas WAF/Página); después, el proxy inverso Traefik de Dokploy; y finalmente, el propio contenedor de la aplicación. Herramientas de diagnóstico cruciales incluyen los registros de la interfaz de usuario de Dokploy, los registros del contenedor Traefik (docker service logs dokploy-traefik), y los registros de eventos de Cloudflare (por ejemplo, eventos de WAF) para identificar el punto exacto de la falla.  
Las robustas características de seguridad de Cloudflare, si bien son muy beneficiosas para proteger las aplicaciones web, pueden interrumpir inadvertidamente procesos automatizados como las renovaciones de certificados Let's Encrypt si no se configuran reglas de bypass específicas para la ruta del desafío ACME. Esto subraya una tensión común en las implementaciones web modernas: la necesidad de un endurecimiento de seguridad fuerte versus la garantía de un funcionamiento fluido de los procesos de infraestructura automatizados. Las configuraciones de seguridad deben equilibrarse cuidadosamente con los requisitos operativos, y a menudo son necesarias excepciones específicas para mantener la automatización.

## **Mejores Prácticas para Implementaciones Seguras en Producción**

Más allá de la configuración inicial, mantener un entorno HTTPS seguro y robusto implica adherirse a ciertas mejores prácticas.

* **Mantenimiento del Modo SSL/TLS Completo (Estricto) en Cloudflare:** Después de una configuración HTTPS exitosa, se recomienda mantener consistentemente el modo SSL/TLS de Cloudflare en Completo (Estricto). Esto asegura el cifrado desde el navegador del visitante hasta su servidor de origen Dokploy, con validación del certificado de origen, proporcionando la postura de seguridad más sólida posible. Es prudente monitorear regularmente su instancia de Dokploy y sus certificados Let's Encrypt para asegurar que sigan siendo válidos, ya que cualquier problema con el certificado de origen puede interrumpir el modo Completo (Estricto).  
* **Comprensión del Enrutamiento Interno de Puertos del Contenedor:** Siempre se debe adherir a la práctica de utilizar expose en su docker-compose.yml y especificar correctamente el "Container Port" en la interfaz de usuario de Dokploy. Esto garantiza que el tráfico se enrute de forma segura a través de Traefik, evitando la exposición pública directa de los puertos de su aplicación y manteniendo un punto de entrada controlado.  
* **Renovación Automatizada de Certificados:** Aproveche la automatización incorporada de Dokploy para las renovaciones de certificados Let's Encrypt. Asegúrese de que su instancia de Dokploy tenga conectividad a Internet consistente y recursos suficientes para que estos procesos automatizados se ejecuten sin problemas. Esto elimina el riesgo de expiración de certificados y la interrupción del servicio debido a la supervisión manual. Aunque automatizado, es prudente implementar un monitoreo externo para las fechas de expiración de los certificados como medida de seguridad, especialmente para aplicaciones críticas.  
* **Implementación de Encabezados de Seguridad Adicionales:** Más allá del HTTPS básico y HSTS, considere añadir otros encabezados de seguridad HTTP para fortalecer aún más su aplicación contra vulnerabilidades web comunes. Si bien Dokploy puede no ofrecer opciones directas en la interfaz de usuario para todos los encabezados, a menudo puede configurarlos a través de middlewares de Traefik en su docker-compose.yml (si Dokploy permite la configuración personalizada de Traefik) o a través de las Reglas de Página/Reglas de Transformación de Cloudflare. Ejemplos incluyen X-Frame-Options: DENY (para prevenir Clickjacking), X-Content-Type-Options: nosniff (para prevenir ataques de "MIME-sniffing") y Content-Security-Policy (CSP) para un control granular sobre las fuentes de contenido, mitigando XSS e inyección de datos. Es importante tener en cuenta que Cloudflare puede añadir o modificar ciertos encabezados; se recomienda revisar la documentación de Cloudflare sobre encabezados HTTP para evitar conflictos.

Una implementación verdaderamente segura emplea una estrategia de "defensa en profundidad". Esto significa no depender de una única capa de seguridad (como el SSL de borde de Cloudflare), sino asegurar que el cifrado y las medidas de seguridad se apliquen en múltiples puntos: desde el borde de Cloudflare hasta el servidor de origen (con un certificado Let's Encrypt válido y el modo Full (Strict)) e incluso dentro del propio contenedor de la aplicación (mediante encabezados de seguridad). Este enfoque multicapa proporciona resiliencia contra diversos vectores de ataque.  
Si bien la interfaz de usuario de Dokploy simplifica muchos aspectos de la implementación y la gestión de SSL, lograr los niveles más altos de endurecimiento de la seguridad (por ejemplo, implementar encabezados de seguridad altamente personalizados o ajustar comportamientos de Traefik) aún puede requerir profundizar en las configuraciones manuales de Docker Compose o aprovechar los conjuntos de reglas más avanzados de Cloudflare. Esto implica una elección estratégica para el usuario: adoptar la simplicidad de Dokploy para tareas comunes, pero estar preparado para interactuar con configuraciones de nivel inferior para requisitos de seguridad específicos.

## **Conclusiones y Recomendaciones**

La obtención de un certificado HTTPS para un proyecto Docker en Dokploy, con la integración de DigitalOcean y Cloudflare, es un proceso que, si bien se simplifica por las herramientas modernas, requiere una comprensión detallada de la interacción entre cada componente. La correcta configuración de DNS en DigitalOcean, la gestión de registros y modos SSL/TLS en Cloudflare, y los ajustes precisos en el archivo docker-compose.yml de Dokploy son pasos interconectados que determinan el éxito de la implementación HTTPS.  
Se recomienda encarecidamente adoptar el modo Completo (Estricto) de SSL/TLS en Cloudflare para garantizar un cifrado de extremo a extremo y la validación del certificado de origen, lo que proporciona la máxima seguridad. Es fundamental utilizar la directiva expose en Docker Compose para los puertos internos de los contenedores, en lugar de ports, para mantener la seguridad y permitir que Traefik gestione el enrutamiento de manera eficiente. Además, la automatización de certificados Let's Encrypt de Dokploy es una característica valiosa que reduce la carga operativa, pero no exime de la necesidad de configurar reglas de bypass específicas en Cloudflare para el desafío ACME, evitando así fallos en la emisión o renovación de certificados.  
Para mitigar los problemas comunes, como los bucles de redirección HTTPS o los fallos en la generación de certificados, es esencial una estrategia de depuración por capas, comenzando por el DNS y avanzando hacia Cloudflare, Traefik y, finalmente, la aplicación. La consistencia en las configuraciones de redirección HTTP/HTTPS a lo largo de toda la cadena de servicio es primordial para evitar bucles. Finalmente, la implementación de encabezados de seguridad adicionales y la monitorización continua de los certificados son prácticas recomendadas para fortalecer la postura de seguridad de las aplicaciones en producción. Si bien Dokploy ofrece una interfaz amigable, la capacidad de profundizar en las configuraciones subyacentes de Docker Compose y Cloudflare es valiosa para abordar requisitos de seguridad avanzados o escenarios de solución de problemas complejos.

#### **Fuentes citadas**

1\. Domains | Dokploy, https://docs.dokploy.com/docs/core/domains 2\. dokku/dokku-letsencrypt: Automatic Let's Encrypt TLS Certificate installation for dokku \- GitHub, https://github.com/dokku/dokku-letsencrypt 3\. Let's Encrypt and Cloudflare. How to set? \- Security, https://community.cloudflare.com/t/lets-encrypt-and-cloudflare-how-to-set/66442 4\. Solving a Let's Encrypt and Cloudflare problem \- Infomaniak, https://www.infomaniak.com/en/support/faq/2517/solving-a-lets-encrypt-and-cloudflare-problem 5\. Instructions \- Multi Server \- Dokploy, https://docs.dokploy.com/docs/core/multi-server/instructions 6\. Cloudflare \- Dokploy, https://docs.dokploy.com/docs/core/domains/cloudflare 7\. How to Configure DNS for DigitalOcean \- YouTube, https://www.youtube.com/watch?v=d8TRPMI8lVk 8\. Troubleshooting | Dokploy, https://docs.dokploy.com/docs/core/troubleshooting 9\. Cert Bot Acme Challenge Failing with challenge folder publicly available, behind Cloudflare proxy \- Reddit, https://www.reddit.com/r/CloudFlare/comments/1136eky/cert\_bot\_acme\_challenge\_failing\_with\_challenge/ 10\. Website in redirect loop after enabling cloudflare ssl \- Security, https://community.cloudflare.com/t/website-in-redirect-loop-after-enabling-cloudflare-ssl/452212 11\. ERR\_TOO\_MANY\_REDIRECTS \- SSL/TLS \- Cloudflare Docs, https://developers.cloudflare.com/ssl/troubleshooting/too-many-redirects/ 12\. Support for Cloudflare Origin CA certificates in Dokploy · Issue \#1839 \- GitHub, https://github.com/Dokploy/dokploy/issues/1839 13\. HTTP Strict Transport Security (HSTS) \- SSL/TLS \- Cloudflare Docs, https://developers.cloudflare.com/ssl/edge-certificates/additional-options/http-strict-transport-security/ 14\. Cloudflare blocking? \- Help \- Let's Encrypt Community Support, https://community.letsencrypt.org/t/cloudflare-blocking/180172 15\. Let Let's Encrypt bot bypass Always Use HTTPS \- Cloudflare Community, https://community.cloudflare.com/t/let-lets-encrypt-bot-bypass-always-use-https/200274 16\. Certbot renew failure via HTTP-01 challenge using Cloudflare \- Help, https://community.letsencrypt.org/t/certbot-renew-failure-via-http-01-challenge-using-cloudflare/232956 17\. Lots of /.well-known/acme-challenge/ requests from Cloudflare AS132892 \- Rules \- Cloudflare Community, https://community.cloudflare.com/t/lots-of-well-known-acme-challenge-requests-from-cloudflare-as132892/583514 18\. About Cloudflare Firewall Rules, https://developers.cloudflare.com/firewall/cf-firewall-rules/ 19\. Adding Request Headers \- Dokploy & Traefik \- Jack Whitworth, https://jackwhitworth.com/blog/adding-request-headers-dokploy-traefik/ 20\. Headers · Cloudflare Pages docs, https://developers.cloudflare.com/pages/configuration/headers/ 21\. Cloudflare HTTP headers · Cloudflare Fundamentals docs, https://developers.cloudflare.com/fundamentals/reference/http-headers/